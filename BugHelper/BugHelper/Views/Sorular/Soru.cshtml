@model BugHelper.Models.SoruCevapModel
@using BugHelper.Scripts.SoruUrl
@{
    ViewBag.Title = "Soru";
    TempData["soruIdCevap"] = ViewBag.soruId;
}

<div class="container" style="overflow:visible;">
    @if(User.Identity.IsAuthenticated && User.Identity.Name != "Misafir") { 
    <div id="oyla">
        @using (Ajax.BeginForm("SoruOyla", "Sorular", new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "oyla" }))
        {

            <input type="hidden" value="@Model.SoruId" name="soruId" />
            if (Model.SoruCevapContext.ArtiOy.Any(i => i.Soru.Id == Model.SoruId && i.ArtiOySahibi == User.Identity.Name))
            {
                <button type="submit" value="arti" name="oy"><img src="https://i.hizliresim.com/kMa04m.png" alt="arti-oy-verildi" /></button>
                <button type="submit" value="eksi" name="oy"><img src="https://img.icons8.com/ios/50/000000/thumbs-down.png" alt="eksi-oy-normal"></button>
            }
            else if (Model.SoruCevapContext.EksiOy.Any(i => i.Soru.Id == Model.SoruId && i.EksiOySahibi == User.Identity.Name))
            {
                <button type="submit" value="arti" name="oy" onclick="oyVerildi()"><img src="https://img.icons8.com/ios/50/000000/thumb-up.png" alt="arti-oy-normal"></button>
                <button type="submit" value="eksi" name="oy"><img src="https://i.hizliresim.com/jqaAEJ.png" alt="eksi-oy-verildi" /></button>
            }
            else
            {
                <button type="submit" value="arti" name="oy"><img src="https://img.icons8.com/ios/50/000000/thumb-up.png" alt="arti-oy-normal"></button>
                <button type="submit" value="eksi" name="oy"><img src="https://img.icons8.com/ios/50/000000/thumbs-down.png" alt="eksi-oy-normal"></button>
            }
        }
    </div>
    }
    <div class="soru-baslik">
        <div>
            @foreach (var item in Model.SoruCevapContext.Sorular.ToList())
            {
                if (item.Id == Model.SoruId)
                {
                    <div class="soru-sahibi">
                        @item.SoruSahibi
                    </div>
                    <div class="baslik">
                        @item.SoruBaslik
                    </div>
                    <div class="soru-icerik">
                        @item.SoruIcerik

                    </div>
                }
            }
        </div>
        @if (User.Identity.IsAuthenticated)
        {
            if (Model.FavorideMi != true)
            {
                <div id="favoriye-ekle">
                    @using (Ajax.BeginForm("FavoriyeEkle", "Kullanici", new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "favoriye-ekle" }))
                    {
                        <input type="hidden" value="@Model.SoruId" name="soruId" />
                        <input type="submit" value="Favoriye Ekle" />
                    }
                </div>
            }
            else
            {
                <div id="favoriden-cikar">
                    @using (Ajax.BeginForm("FavoridenCikar", "Kullanici", new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "favoriden-cikar" }))
                    {
                        <input type="hidden" value="@Model.SoruId" name="soruId" />
                        <input type="submit" value="Favorilerden Çıkar" />
                    }
                </div>
            }
            <div class="favoriler">
                <a href="@Url.Action("FavoriSorular", "Kullanici", new { kullaniciAdi = @FriendlyURL.FriendlyURLTitle(User.Identity.Name)})">
                    Favoriler
                </a>
            </div>
        }
    </div>

    <div class="cevapla">
        @using (Ajax.BeginForm("Cevapla", "Cevaplar", new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "msj" }))
        {
            <input type="hidden" value="@Model.SoruId" name="soruIdCevap" />
            <input type="text" name="gelenCevap">
            <input type="submit" value="Gönder" id="Cevapla" />
        }
    </div>

    <div id="msj">
        @foreach (var item in Model.CevaplarModelForSoru)
        {
                <div class="cevap">
                    @item.Cevap
                </div>
        }
    </div>
</div>




